<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user">

  <select id="totalCount" resultType="int">
    SELECT COUNT(*) FROM user_table;
  </select>

  <select id="searchCount" resultType="int" parameterType="String">
    SELECT COUNT(*) FROM user_table WHERE
    email LIKE CONCAT('%', #{keyword}, '%') OR nick LIKE CONCAT('%', #{keyword}, '%')
  </select>

  <select id="list" resultType="mybatis.vo.UserVO" parameterType="Map">
    SELECT * FROM (
    SELECT @RN := @RN + 1 AS rnum, a.*
    FROM (
    SELECT * FROM user_table
    ORDER BY idx
    ) a, (SELECT @RN := 0) b
    ) c
    WHERE c.rnum BETWEEN #{begin} AND #{end}
  </select>

  <select id="searchList" resultType="mybatis.vo.UserVO" parameterType="Map">
    SELECT * FROM (
    SELECT @RN := @RN + 1 AS rnum, a.*
    FROM ( SELECT * FROM user_table WHERE nick LIKE CONCAT('%', #{keyword}, '%')
    ORDER BY idx
    ) a, (SELECT @RN := 0) b
    ) c
    WHERE c.rnum BETWEEN #{begin} AND #{end}
  </select>

  <update id="edit" parameterType="mybatis.vo.UserVO">
    UPDATE user_table SET email = #{email}, nick = #{nick}, pw = #{pw}, status = #{status} WHERE idx = #{idx}
  </update>

  <!-- 이메일과 비밀번호로 사용자 조회 -->
  <!-- 로그인 중복확인 -->
  <select id="loginCheck" parameterType="map" resultType="mybatis.vo.UserVO">
    SELECT idx, email, pw, nick, status
    FROM user_table
    WHERE email = #{email}
    AND pw = #{pw}
  </select>

  <update id="updateUserProfile" parameterType="mybatis.vo.UserVO">
    UPDATE user_table
    SET nick = #{nick},
    pw = #{pw}
    WHERE idx = #{idx}
  </update>

  <update id="deactivateUser">
    UPDATE user_table
    SET status = 1
    WHERE idx = #{idx}
  </update>

  <select id="checkPassword" parameterType="map" resultType="string">
    SELECT pw FROM user_table WHERE idx = #{idx}
  </select>

  <select id="getPassword" parameterType="int" resultType="string">
    SELECT pw FROM user_table WHERE idx = #{idx}
  </select>

</mapper>